# Update OpenSpec Agent Instructions

## Why

The current OpenSpec agent instructions need updates to follow best practices for AI assistant instructions (brevity, clarity, removing ambiguity), ensure CLI commands are current with the actual implementation, and properly document the three-stage workflow pattern that agents should follow.

## What Changes

### Core Structure Improvements
- **Front-load the 3-stage workflow** as the primary mental model:
  1. Creating a change proposal (proposal.md, spec deltas, design.md, tasks.md)
  2. Implementing a change proposal (following tasks, marking completion)
  3. Archiving the change proposal (using archive command after deployment)
- **Reduce instruction length by 50%** while maintaining all critical information
- **Restructure with clear hierarchy**: Core Workflow → Quick Start → Commands → Details → Edge Cases

### Decision Clarity Enhancements
- **Add clear decision trees** for common scenarios (bug vs feature, proposal needed vs not)
- **Remove ambiguous conditions** that confuse agent decision-making
- **Add "Before Any Task" checklist** for context gathering
- **Add "Before Creating Specs" rule** - Always check existing specs first to avoid duplicates

### CLI Documentation Updates
- **Complete command documentation** with all current functionality:
  - `openspec init [path]` - Initialize OpenSpec in a project
  - `openspec list` - List all active changes (default)
  - `openspec list --specs` - List all specifications
  - `openspec show [item]` - Display change or spec with auto-detection
  - `openspec show` - Interactive mode for selection
  - `openspec diff [change]` - Show spec differences for a change
  - `openspec validate [item]` - Validate changes or specs
  - `openspec archive [change]` - Archive completed change after deployment
  - `openspec update [path]` - Update OpenSpec instruction files
- **Document all flags and options**:
  - `--json` output format for programmatic use
  - `--type change|spec` for disambiguation
  - `--skip-specs` for tooling-only archives
  - `--strict` for strict validation mode
  - `--no-interactive` to disable prompts
- **Remove deprecated command references** (noun-first patterns like `openspec change show`)
- **Add concrete examples** for each command variation

### Agent-Specific Improvements
- **Spec discovery workflow** - Always check existing specs before creating new ones:
  - Use `openspec list --specs` to see all current specs
  - Check if capability already exists before creating
  - Prefer modifying existing specs over creating duplicates
- **Tool selection matrix** - When to use Grep vs Glob vs Read
- **Error recovery patterns** - How to handle common failures
- **Context management guide** - What to read before starting tasks
- **Verification workflows** - How to confirm changes are correct

### Best Practices Section
- **Be concise** - One-line answers when appropriate
- **Be specific** - Use exact file paths and line numbers (file.ts:42)
- **Start simple** - Default to <100 lines, single-file implementations
- **Justify complexity** - Require data/metrics for any optimization

## Impact

- Affected specs: None (this is a tooling/documentation change)
- Affected code: 
  - `src/core/templates/claude-template.ts` - Update CLAUDE.md template
- Affected documentation:
  - `openspec/README.md` - Main OpenSpec instructions
  - CLAUDE.md files generated by `openspec init` command

Note: This is a tooling/infrastructure change that doesn't require spec updates. When archiving, use `openspec archive update-agent-instructions --skip-specs`.